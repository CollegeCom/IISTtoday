{% extends 'base.html' %}
{% block title %}
  Home - CollegeCom
{% endblock title %}
{% block pagetitle %}
   Dashboard
{% endblock pagetitle %}
   

{% block begincontent %}
				
					<!--begin::Content-->
					<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
						<!--begin::Entry-->
						<div class="d-flex flex-column-fluid">
							<!--begin::Container-->
							<div class="container">
								<!--begin::Education-->
								<div class="d-flex flex-column flex-md-row" >
									<!--begin::Aside-->
									<div class="flex-md-row-auto w-md-275px w-xl-325px" >
										<!--begin::Nav Panel Widget 3-->
										<div class="card card-custom gutter-b " >
											<!--begin::Body-->
											<div class="card-body">
												<!--begin::Wrapper-->
												<div class=" d-flex justify-content-between flex-column h-100">
													<!--begin::Container-->
													<div class="h-100">
														<!--begin::Header-->
														<div class="d-flex flex-column flex-center">
															<!--begin::Image-->
															<div class="bgi-no-repeat bgi-size-cover rounded min-h-180px w-100" style="background-image: url(/static/media/stock-600x400/img-70.jpg)"></div>
															<!--end::Image-->
															<!--begin::Title-->
															<a href="#" class="card-title font-weight-bolder text-dark-75 text-hover-primary font-size-h4 m-0 pt-7 pb-1">IIST Indore</a>
															<!--end::Title-->
															<!--begin::Text-->
															<div class="font-weight-bold text-dark-50 font-size-sm pb-7">Rau , Indore (M.P)</div>
															<!--end::Text-->
														</div>
														<!--end::Header-->
														<!--begin::Body-->
														<div class="pt-1">
															<!--begin::Item-->
															<div class="d-flex align-items-center pb-9">
																<!--begin::Symbol-->
																<div class="symbol symbol-45 symbol-light mr-4">
																	<span class="symbol-label">
																		<span class="svg-icon svg-icon-2x svg-icon-dark-50">
																			<!--begin::Svg Icon | path:/static/media/svg/icons/Media/Equalizer.svg-->
																			<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																				<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
																					<rect x="0" y="0" width="24" height="24" />
																					<rect fill="#000000" opacity="0.3" x="13" y="4" width="3" height="16" rx="1.5" />
																					<rect fill="#000000" x="8" y="9" width="3" height="11" rx="1.5" />
																					<rect fill="#000000" x="18" y="11" width="3" height="9" rx="1.5" />
																					<rect fill="#000000" x="3" y="13" width="3" height="7" rx="1.5" />
																				</g>
																			</svg>
																			<!--end::Svg Icon-->
																		</span>
																	</span>
																</div>
																<!--end::Symbol-->
																<!--begin::Text-->
																<div class="d-flex flex-column flex-grow-1">
																	<a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder">Current Sem</a>
														
																</div>
																<!--end::Text-->
																<!--begin::label-->
																<span class="font-weight-bolder label label-xl label-light-success label-inline px-3 py-5 min-w-45px">6</span>
																<!--end::label-->
															</div>
															<!--end::Item-->
															<!--begin::Item-->
															<div class="d-flex align-items-center pb-9">
																<!--begin::Symbol-->
																<div class="symbol symbol-45 symbol-light mr-4">
																	<span class="symbol-label">
																		<span class="svg-icon svg-icon-2x svg-icon-dark-50">
																			<!--begin::Svg Icon | path:/static/media/svg/icons/Communication/Group.svg-->
																			<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																				<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
																					<polygon points="0 0 24 0 24 24 0 24" />
																					<path d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
																					<path d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
																				</g>
																			</svg>
																			<!--end::Svg Icon-->
																		</span>
																	</span>
																</div>
																<!--end::Symbol-->
																<!--begin::Text-->
																<div class="d-flex flex-column flex-grow-1">
																	<a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder">Branch</a>
		
																</div>
																<!--end::Text-->
																<!--begin::label-->
																<span class="font-weight-bolder label label-xl label-light-danger label-inline px-3 py-5 min-w-45px">IT</span>
																<!--end::label-->
															</div>
															<!--end::Item-->
															
														</div>
														<!--end::Body-->
													</div>
													<!--eng::Container-->
												
												</div>
												<!--end::Wrapper-->
											</div>
											<!--end::Body-->
										</div>
										<!--end::Nav Panel Widget 3-->	
									</div>
									<!--end::Aside-->
									<!--begin::Content-->
									<div class="flex-md-row-fluid ml-md-6 ml-lg-8">
										<div class="row">
											<div class="col-xxl-7 " data-scroll="true" data-height="550">
												<!--begin::Forms Widget 2-->
												<div class="card card-custom gutter-b">
													<!--begin::Body-->
													<div class="card-body">
														<!--begin::Top-->
														<div class="d-flex align-items-center">
															<!--begin::Symbol-->
															<div class="symbol  mr-5">
																<span class="symbol-label rounded-circle">
																	<img src="/media/{{euser.profileimg}}" class="h-100 align-self-end rounded-circle symbol-40" alt="" />
																</span>
															</div>
															<!--end::Symbol-->
															<!--begin::Description-->
															<span class="text-muted font-weight-bold font-size-lg">Whatâ€™s on your mind, {{euser.user.first_name}}?</span>
															<!--end::Description-->
														</div>
														<!--end::Top-->
														<!--begin::Form-->
														<form id="feed-form" class="form-group">{% csrf_token %}
															<textarea class="form-control border-0 p-0 mt-4 mb-4" rows="2" name="message" placeholder="Type a message" id="msg_field" required></textarea>
															<img class="rounded" id="image-show" style="width:40%;" > 
															<div class="d-flex align-items-center justify-content-between mt-5 col-lg-6 pt-3" style="margin-bottom:-40px;">
																<div class="mr-3">
																	<div class="image-input image-input-outline image-input-circle ml-9" style="margin-top:-20px;">
																		<label class="btn btn-xs btn-icon btn-white btn-hover-text-primary" data-action="change" data-toggle="tooltip" title="" data-original-title="Add Photo">
																			<i class="flaticon2-photograph icon-lg"></i></i>
																			<input type="file" id="post_image" accept=".png, .jpg, .jpeg" onchange="loadFile(event)">
																		</label>															
																	</div>
																</div>
																
																
															</div>
														</form>
														<div class="col-lg-6 float-right ">
														<button onclick="feedpost()" class="btn btn-primary btn-md text-uppercase font-weight-bold py-2 px-6 float-right">Post</button>
														</div>
														<!--end::Form-->
													</div>
													<!--end::Body-->
												</div>
												<!--end::Forms Widget 2-->
												<!--begin::Forms Widget 4-->
												<div class="feed-card" >
												<div id="feed-card"></div>
												{% for f in feed %}
												<div class="card card-custom gutter-b">
													<!--begin::Body-->
													<div class="card-body">
														<!--begin::Top-->
														<div class="d-flex align-items-center">
															<!--begin::Symbol-->
															<div class="symbol mr-5 ">
																<span class="symbol-label symbol-40 rounded-circle">
																	<img src="/media/{{f.posted_by.profileimg}}" class="h-100 rounded-circle align-self-end" alt="" />
																</span>
															</div>
															<!--end::Symbol-->
															<!--begin::Info-->
															<div class="d-flex flex-column flex-grow-1">
																<a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder">{{f.posted_by.user.first_name}} {{f.posted_by.user.last_name}}</a>
																<span class="text-muted font-weight-bold">{{f.date_time}}</span>
															</div>
															<!--end::Info-->
														</div>
														<!--end::Top-->
														<!--begin::Bottom-->
														<div class="pt-4">
															<!--begin::Image-->
															<p class="text-dark-75 font-size-lg font-weight-normal pt-1 mb-2">{{f.message}}</p>
															{% if f.image %}
															<img src="/media/{{f.image}}" class="w-100 rounded mb-3" alt="" >{% endif %}
															<!--end::Image-->
															<!--begin::Text-->
															
															<!--end::Text-->
															<!--begin::Action-->
															<div class="accordion accordion-light accordion-light-borderless accordion-svg-toggle" id="accordionExample7">
															<div class="d-flex align-items-center">
																<a href="#" data-toggle="collapse" data-target="#ca{{f.id}}" class="btn btn-hover-text-primary btn-hover-icon-primary btn-sm btn-text-dark-50 bg-hover-light-primary rounded font-weight-bolder font-size-sm p-2">
																<span class="svg-icon svg-icon-primary svg-icon-2x"><!--begin::Svg Icon | path:C:\wamp64\www\keenthemes\themes\metronic\theme\html\demo2\dist/../src/media/svg/icons\Communication\Chat6.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																	<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
																		<rect x="0" y="0" width="24" height="24"/>
																		<path opacity="0.3" fill-rule="evenodd" clip-rule="evenodd" d="M14.4862 18L12.7975 21.0566C12.5304 21.54 11.922 21.7153 11.4386 21.4483C11.2977 21.3704 11.1777 21.2597 11.0887 21.1255L9.01653 18H5C3.34315 18 2 16.6569 2 15V6C2 4.34315 3.34315 3 5 3H19C20.6569 3 22 4.34315 22 6V15C22 16.6569 20.6569 18 19 18H14.4862Z" fill="black"/>
																<path fill-rule="evenodd" clip-rule="evenodd" d="M6 7H15C15.5523 7 16 7.44772 16 8C16 8.55228 15.5523 9 15 9H6C5.44772 9 5 8.55228 5 8C5 7.44772 5.44772 7 6 7ZM6 11H11C11.5523 11 12 11.4477 12 12C12 12.5523 11.5523 13 11 13H6C5.44772 13 5 12.5523 5 12C5 11.4477 5.44772 11 6 11Z" fill="black"/>
																	</g>
																</svg><!--end::Svg Icon--></span>{{f.comments}} Comments</a>
																
															</div>
															<div class="collapse" id="ca{{f.id}}" >
															
															{% if f.feeds.all %}
															   {% for c in f.feeds.all %}
															      <div class="d-flex py-5">
																	<!--begin::Symbol-->
																	<div class="symbol mr-5 mt-1">
																		<span class="symbol-label symbol-40">
																			<img src="/media/{{c.posted_by.profileimg}}" class="h-100 rounded-circle align-self-end" alt="">
																		</span>
																	</div>
																	<!--end::Symbol-->
																	<!--begin::Info-->
																	<div class="d-flex flex-column flex-row-fluid">
																		<!--begin::Info-->
																		<div class="d-flex align-items-center flex-wrap">
																			<a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder pr-6">{{c.posted_by.user.first_name}} {{c.posted_by.user.last_name}}</a>
																			<span class="text-muted font-weight-normal flex-grow-1 font-size-sm"></span>
																			<span class="text-muted font-weight-normal font-size-sm">{{c.date}}</span>
																		</div>
																		<span class="text-dark-75 font-size-sm font-weight-normal pt-1">{{c.comment}}</span>
																		<!--end::Info-->
																	</div>
																	<!--end::Info-->
																</div>
															   {% endfor %}
															   
															{% endif %}
															</div>
															</div>
															<!--end::Action-->
														</div>
														<!--end::Bottom-->
														<!--begin::Separator-->
														<div class="separator separator-solid mt-2 mb-4"></div>
														<!--end::Separator-->
														<!--begin::Editor-->
														<form class="position-relative" action="/add-comment" method="post">{% csrf_token %}
															<textarea class="form-control border-0 p-0 pr-10 resize-none" name="comment" rows="1" placeholder="Reply..."></textarea>
															<input type="number" name="feedid" value="{{f.id}}" hidden>
															<div class="position-absolute top-0 right-0 mt-n1 mr-n2">
																<button class="btn btn-sm btn-primary" type="submit">Reply</button>
															</div>
														</form>
														<!--edit::Editor-->
													</div>
													<!--end::Body-->
												</div>
												{% endfor %}
												</div>
												<!--End Widgets 4-->
											</div>
											<div class="col-xl-5">
										<!--begin::List Widget 16-->
										<div class="card card-custom card-stretch gutter-b">
											<!--begin::Header-->
											<div class="card-header border-0">
												<h3 class="card-title font-weight-bolder text-dark">Latest Events</h3>
											</div>
											<!--end:Header-->
											<!--begin::Body-->
											<div class="card-body pt-2">
											{% for e in events  %}
												<!--begin::Item-->
												<div class="d-flex flex-wrap align-items-center pb-10">
													<!--begin::Symbol-->
													<div class="symbol symbol-50 symbol-2by3 flex-shrink-0 mr-4">
														<div class="symbol-label" style="background-image: url('/media/{{e.poster}}')"></div>
													</div>
													<!--end::Symbol-->
													<!--begin::Title-->
													<div class="d-flex flex-column flex-grow-1 my-lg-0 my-2 mr-2">
														<a href="#" class="text-dark font-weight-bold text-hover-primary mb-1 font-size-lg">{{e.title}}</a>
														<span class="text-muted font-weight-bold">{{e.start_date}}</span>
													</div>
													<!--end::Title-->
													<!--begin::Btn-->
													<a href="#" class="btn btn-icon btn-light btn-sm">
														<span class="svg-icon svg-icon-success">
															<span class="svg-icon svg-icon-md">
																<!--begin::Svg Icon | path:assets/media/svg/icons/Navigation/Arrow-right.svg-->
																<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																	<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
																		<polygon points="0 0 24 0 24 24 0 24"></polygon>
																		<rect fill="#000000" opacity="0.3" transform="translate(12.000000, 12.000000) rotate(-90.000000) translate(-12.000000, -12.000000)" x="11" y="5" width="2" height="14" rx="1"></rect>
																		<path d="M9.70710318,15.7071045 C9.31657888,16.0976288 8.68341391,16.0976288 8.29288961,15.7071045 C7.90236532,15.3165802 7.90236532,14.6834152 8.29288961,14.2928909 L14.2928896,8.29289093 C14.6714686,7.914312 15.281055,7.90106637 15.675721,8.26284357 L21.675721,13.7628436 C22.08284,14.136036 22.1103429,14.7686034 21.7371505,15.1757223 C21.3639581,15.5828413 20.7313908,15.6103443 20.3242718,15.2371519 L15.0300721,10.3841355 L9.70710318,15.7071045 Z" fill="#000000" fill-rule="nonzero" transform="translate(14.999999, 11.999997) scale(1, -1) rotate(90.000000) translate(-14.999999, -11.999997)"></path>
																	</g>
																</svg>
																<!--end::Svg Icon-->
															</span>
														</span>
													</a>
													<!--end::Btn-->
												</div>
												{% endfor %}
												
												<div class="separator separator-solid mt-2 mb-4"></div>					
												<h4 class="card-title font-weight-bolder text-dark">Recent Notices</h4>
												{% for n in notices  %}
												<!--begin::Item-->
												<div class="d-flex flex-wrap align-items-center pb-10">
													<!--begin::Symbol-->
													{% comment %} <div class="symbol symbol-50 symbol-2by3 flex-shrink-0 mr-4">
														<div class="symbol-label" style="background-image: url('/media/{{e.poster}}')"></div>
													</div> {% endcomment %}
													<!--end::Symbol-->
													<!--begin::Title-->
													<div class="d-flex flex-column flex-grow-1 my-lg-0 my-2 mr-2">
														<a href="#" class="text-dark font-weight-bold text-hover-primary mb-1 font-size-lg">{{n.title}}</a>
														<span class="text-muted font-weight-bold">{{n.date}}</span>
													</div>
													<!--end::Title-->
													<!--begin::Btn-->
													<a href="#" class="btn btn-icon btn-light btn-sm">
														<span class="svg-icon svg-icon-success">
															<span class="svg-icon svg-icon-md">
																<!--begin::Svg Icon | path:assets/media/svg/icons/Navigation/Arrow-right.svg-->
																<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																	<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
																		<polygon points="0 0 24 0 24 24 0 24"></polygon>
																		<rect fill="#000000" opacity="0.3" transform="translate(12.000000, 12.000000) rotate(-90.000000) translate(-12.000000, -12.000000)" x="11" y="5" width="2" height="14" rx="1"></rect>
																		<path d="M9.70710318,15.7071045 C9.31657888,16.0976288 8.68341391,16.0976288 8.29288961,15.7071045 C7.90236532,15.3165802 7.90236532,14.6834152 8.29288961,14.2928909 L14.2928896,8.29289093 C14.6714686,7.914312 15.281055,7.90106637 15.675721,8.26284357 L21.675721,13.7628436 C22.08284,14.136036 22.1103429,14.7686034 21.7371505,15.1757223 C21.3639581,15.5828413 20.7313908,15.6103443 20.3242718,15.2371519 L15.0300721,10.3841355 L9.70710318,15.7071045 Z" fill="#000000" fill-rule="nonzero" transform="translate(14.999999, 11.999997) scale(1, -1) rotate(90.000000) translate(-14.999999, -11.999997)"></path>
																	</g>
																</svg>
																<!--end::Svg Icon-->
															</span>
														</span>
													</a>
													<!--end::Btn-->
												</div>
												{% endfor %}
									


												<!--end::Item-->
											</div>
											<!--end::Body-->
										</div>
										<!--end::List Widget 13-->
										
									</div>
										</div>
									</div>
									<!--end::Content-->
								</div>
								<!--end::Education-->
							</div>
							<!--end::Container-->
						</div>
						<!--end::Entry-->
					</div>


{% endblock begincontent %}

{% block script %}
<script>

  var loadFile = function(event) {
    var output = document.getElementById('image-show');
    output.src = URL.createObjectURL(event.target.files[0]);
    output.onload = function() {
      URL.revokeObjectURL(output.src) // free memory
    }
	$('#image-show').show();
  };
</script>

<script>
		function feedpost(){
		var data=new FormData();
		var pdata={
		message:$('#msg_field').val(),
		csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
		}

		data.append("postimage",$("#post_image")[0].files[0]);

		if($('#msg_field').val() ||  $("#post_image")[0].files[0]){
		
		
		var data=new FormData();
		var pdata={
				message:$('#msg_field').val(),
				csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
	  }
	  
	  data.append("postimage",$("#post_image")[0].files[0]);
	  var i;
	  for (var[key,value] of Object.entries(pdata)){
		  data.append(key,value);
	  }
	  $.ajax({
			type: "POST",
			url: "/add-post",
			data:data, 
			contentType:false,
			processData:false,
			enctype: 'multipart/form-data',
			success: function (image_source){
					toastr.success("Post Added Successfully");	
					showrecent(image_source)
			}
	  });
		}
	else{
		toastr.error("Enter Something to Post");
	}
}

function showrecent(image_src){
	  const text_box ='<div class="card card-custom gutter-b">'+
					'<div class="card-body">'+
						'<div class="d-flex align-items-center">'+
							'<div class="symbol mr-5 ">'+
								'<span class="symbol-label symbol-40 rounded-circle">'+
									'<img src="/media/{{euser.profileimg}}" class="h-100 rounded-circle align-self-end" alt="" />'+
								'</span>'+
							'</div>'+
							'<div class="d-flex flex-column flex-grow-1">'+
								'<a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder">{{euser.user.first_name}} {{euser.user.last_name}}</a>'+
								'<span class="text-muted font-weight-bold">{time}</span>'+
							'</div>'+
						'</div>'+
						'<div class="pt-4">'+
							'<p class="text-dark-75 font-size-lg font-weight-normal pt-1 mb-2">{message}</p>'+
							'<img src="/media/{image}" class="w-100 rounded" alt="">'+
						'</div>'+
					'</div>'+
				'</div>'
			var field = text_box.replace('{message}', $('#msg_field').val());
			var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth()+1;//January is 0!`

			var yyyy = today.getFullYear();
			if(dd<10){dd='0'+dd}
			if(mm<10){mm='0'+mm}
			var today = mm+'/'+dd+'/'+yyyy;
			field = field.replace('{time}',today);

			if(image_src){
			field = field.replace('{image}', image_src);
			}
			else{
				field = field.replace('src="/media/{image}', "");
			}
			
			$('#feed-card').append(field);
			$('#msg_field').val("");
			$('#image-show').hide();	
			
}
</script>


{% endblock script %}



